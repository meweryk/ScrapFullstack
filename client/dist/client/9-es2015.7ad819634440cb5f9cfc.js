(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{VzIN:function(t,e,i){"use strict";i.r(e);var r=i("ofXK"),s=i("PCNd"),n=i("O+p6"),c=i("fXoL"),o=i("pmbY"),b=i("bzVh"),d=i("3Pt+");const l=["start"],a=["end"];let h=(()=>{class t{constructor(){this.onFilter=new c.n,this.isValid=!0}ngOnDestroy(){this.start.destroy(),this.end.destroy()}ngAfterViewInit(){this.start=n.a.initDatepicker(this.startRef,this.validate.bind(this)),this.end=n.a.initDatepicker(this.endRef,this.validate.bind(this))}validate(){this.isValid=!this.start.date||!this.end.date||this.start.date<this.end.date}submitFilter(){const t={};this.order&&(t.order=this.order),this.start.date&&(t.start=this.start.date),this.end.date&&(t.end=this.end.date),this.onFilter.emit(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Eb({type:t,selectors:[["app-history-filter"]],viewQuery:function(t,e){var i;1&t&&(c.vc(l,!0),c.vc(a,!0)),2&t&&(c.gc(i=c.Xb())&&(e.startRef=i.first),c.gc(i=c.Xb())&&(e.endRef=i.first))},outputs:{onFilter:"onFilter"},decls:20,vars:2,consts:[[1,"filter"],[1,"fr"],[1,"col","order"],[1,"input-field","inline","order-position-input"],["type","number","id","number","min","1",3,"ngModel","ngModelChange"],["for","number"],[1,"col","filter-pickers"],[1,"input-field"],["type","text"],["start",""],["end",""],[1,"btn","waves-effect","wavers-light","btn-small",3,"disabled","click"]],template:function(t,e){1&t&&(c.Ob(0,"div",0),c.Ob(1,"div",1),c.Ob(2,"div",2),c.Ob(3,"div",3),c.Ob(4,"input",4),c.Wb("ngModelChange",(function(t){return e.order=t})),c.Mb(),c.Ob(5,"label",5),c.qc(6,"\u0417\u0430\u043a\u0430\u0437 \u2116"),c.Mb(),c.Mb(),c.Mb(),c.Ob(7,"div",6),c.Ob(8,"div",7),c.Lb(9,"input",8,9),c.Ob(11,"label"),c.qc(12,"\u041d\u0430\u0447\u0430\u043b\u043e"),c.Mb(),c.Mb(),c.Ob(13,"div",7),c.Lb(14,"input",8,10),c.Ob(16,"label"),c.qc(17,"\u041a\u043e\u043d\u0435\u0446"),c.Mb(),c.Mb(),c.Mb(),c.Mb(),c.Ob(18,"button",11),c.Wb("click",(function(t){return e.submitFilter()})),c.qc(19,"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440"),c.Mb(),c.Mb()),2&t&&(c.yb(4),c.cc("ngModel",e.order),c.yb(14),c.cc("disabled",!e.isValid))},directives:[d.m,d.a,d.i,d.k],styles:[""]}),t})();var f=i("IYfF"),u=i("BbU2");const O=["modal"],p=["select"],g=function(t){return{backgroundColor:t}};function y(t,e){if(1&t){const t=c.Pb();c.Ob(0,"tr",1),c.Ob(1,"td"),c.qc(2),c.Mb(),c.Ob(3,"td"),c.qc(4),c.Zb(5,"date"),c.Mb(),c.Ob(6,"td"),c.qc(7),c.Zb(8,"date"),c.Mb(),c.Ob(9,"td"),c.qc(10),c.Mb(),c.Ob(11,"td"),c.Ob(12,"button",18),c.Wb("click",(function(i){c.jc(t);const r=e.$implicit;return c.Yb().selectOrder(r)})),c.Ob(13,"i",17),c.qc(14,"open_in_new"),c.Mb(),c.Mb(),c.Mb(),c.Mb()}if(2&t){const t=e.$implicit,i=c.Yb();c.Cb("bold",!t.view),c.cc("ngStyle",c.ec(13,g,i.shop===t.shopBuyer?"#eaffd5b0":"none")),c.yb(2),c.rc(t.order),c.yb(2),c.rc(c.bc(5,7,t.date,"dd.MM.yyyy")),c.yb(3),c.rc(c.bc(8,10,t.date,"HH:mm:ss")),c.yb(3),c.sc("",i.computePrice(t)," \u0433\u0440\u043d."),c.yb(2),c.nc("color",i.shop===t.shopBuyer?"lawngreen":"none")}}function M(t,e){if(1&t&&(c.Ob(0,"tr"),c.Ob(1,"td"),c.qc(2),c.Mb(),c.Ob(3,"td"),c.qc(4),c.Mb(),c.Ob(5,"td"),c.qc(6),c.Mb(),c.Ob(7,"td"),c.qc(8),c.Mb(),c.Mb()),2&t){const t=e.$implicit;c.yb(2),c.rc(t.name),c.yb(2),c.rc(t.quantity),c.yb(2),c.sc("",t.cost,"\u0433\u0440\u043d."),c.yb(2),c.rc(t.shopSeller)}}function v(t,e){if(1&t&&(c.Ob(0,"div",19),c.Ob(1,"h5",20),c.qc(2),c.Mb(),c.Ob(3,"p"),c.qc(4),c.Lb(5,"br"),c.qc(6),c.Zb(7,"date"),c.Mb(),c.Ob(8,"table",21),c.Ob(9,"thead"),c.Ob(10,"tr"),c.Ob(11,"th"),c.qc(12,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"),c.Mb(),c.Ob(13,"th"),c.qc(14,"\u041a\u043e\u043b-\u0432\u043e"),c.Mb(),c.Ob(15,"th"),c.qc(16,"\u0426\u0435\u043d\u0430"),c.Mb(),c.Ob(17,"th"),c.qc(18,"\u041f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a"),c.Mb(),c.Mb(),c.Mb(),c.Ob(19,"tbody"),c.oc(20,M,9,4,"tr",22),c.Mb(),c.Mb(),c.Ob(21,"div",23),c.Ob(22,"p"),c.qc(23,"\u041e\u0431\u0449\u0435\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e "),c.Ob(24,"strong"),c.qc(25),c.Mb(),c.Lb(26,"br"),c.qc(27,"\u041e\u0431\u0449\u0430\u044f \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c "),c.Ob(28,"strong"),c.qc(29),c.Mb(),c.Mb(),c.Mb(),c.Mb()),2&t){const t=c.Yb();c.yb(2),c.sc("\u0417\u0430\u043a\u0430\u0437 \u2116",t.selectedOrder.order,""),c.yb(2),c.tc("\u0417\u0430\u043a\u0430\u0437\u0447\u0438\u043a: ",t.selectedOrder.shopBuyer," - ",t.selectedOrder.nicname,""),c.yb(2),c.sc(" ",c.bc(7,7,t.selectedOrder.date,"\u0414\u0430\u0442\u0430 dd.MM.yyyy, \u0432\u0440\u0435\u043c\u044f HH:mm"),""),c.yb(14),c.cc("ngForOf",t.selectedOrder.list),c.yb(5),c.sc("",t.computeWeight(t.selectedOrder)," \u0442."),c.yb(4),c.sc("",t.computePrice(t.selectedOrder)," \u0433\u0440\u043d.")}}const m=function(){return{backgroundColor:"#ffeccd"}},w=function(t,e){return[t,e]};let q=(()=>{class t{constructor(t,e){this.auth=t,this.ordersService=e,this.orderEmitter=new c.n,this.searchOrd="",this.workOrder=!1,this.today=new Date,this._id="",this.view=null,this.send=null,this.got=null}ngOnInit(){this.shop=this.auth.getShop()}ngOnDestroy(){this.modal.destroy(),this.select.destroy()}ngAfterViewInit(){this.modal=n.a.initModal(this.modalRef),this.select=n.a.initFormSelect(this.selectRef)}computePrice(t){return+t.list.reduce((t,e)=>t+e.quantity*e.cost,0).toFixed(2)}computeWeight(t){return+t.list.reduce((t,e)=>t+e.quantity,0).toFixed(3)}selectOrder(t){this.selectedOrder=t,this.workOrder=this.selectedOrder.shopBuyer===this.shop,this.modal.open(),this.selectedOrder.view||0!=this.workOrder||this.update()}update(){const t=Object.assign({},{_id:this.selectedOrder._id,view:"f",send:this.send,got:this.got});this.ordersService.update(t).subscribe(e=>{const i=this.gsorders.findIndex(e=>e._id===t._id);this.gsorders[i].view=e.view,n.a.toast(`\u0417\u0430\u043a\u0430\u0437 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u043e\u043c ${this.shop}`)},t=>n.a.toast(t.error.message))}addDelivery(){this.orderEmitter.emit(this.selectedOrder),this.modal.close()}closeModal(){this.modal.close()}}return t.\u0275fac=function(e){return new(e||t)(c.Kb(f.a),c.Kb(o.a))},t.\u0275cmp=c.Eb({type:t,selectors:[["app-history-list"]],viewQuery:function(t,e){var i;1&t&&(c.vc(O,!0),c.vc(p,!0)),2&t&&(c.gc(i=c.Xb())&&(e.modalRef=i.first),c.gc(i=c.Xb())&&(e.selectRef=i.first))},inputs:{gsorders:"gsorders"},outputs:{orderEmitter:"onAddDelivery"},decls:40,vars:15,consts:[[1,"highlight","mb2"],[3,"ngStyle"],[1,"input-field",2,"cursor","pointer","width","6rem"],[3,"ngModel","ngModelChange"],["select",""],["value","","selected",""],[2,"font-size","14px"],[3,"value"],["value","exportOrd"],[3,"ngStyle","bold",4,"ngFor","ngForOf"],[1,"modal","modal-fixed-footer"],["modal",""],["class","modal-content",4,"ngIf"],[1,"modal-footer"],[1,"modal-action","waves-effect","waves-black","btn-flat",3,"disabled"],[1,"modal-action","waves-effect","waves-black","btn-flat",3,"disabled","click"],[1,"modal-action","waves-effect","waves-black","btn-flat",3,"click"],[1,"material-icons"],[1,"btn","btn-small","grey","darken-1",3,"click"],[1,"modal-content"],[1,"mb1","blue-grey-text","text-darken-3"],[1,"highlight"],[4,"ngFor","ngForOf"],[1,"order-summary"]],template:function(t,e){1&t&&(c.Ob(0,"table",0),c.Ob(1,"thead"),c.Ob(2,"tr",1),c.Ob(3,"th"),c.qc(4,"\u2116"),c.Mb(),c.Ob(5,"th"),c.qc(6,"\u0414\u0430\u0442\u0430"),c.Mb(),c.Ob(7,"th"),c.qc(8,"\u0412\u0440\u0435\u043c\u044f"),c.Mb(),c.Ob(9,"th"),c.qc(10,"\u0421\u0443\u043c\u043c\u0430"),c.Mb(),c.Ob(11,"th"),c.Ob(12,"div",2),c.Ob(13,"select",3,4),c.Wb("ngModelChange",(function(t){return e.searchOrd=t})),c.Ob(15,"option",5),c.Ob(16,"span",6),c.qc(17,"\u0412\u0441\u0435"),c.Mb(),c.Mb(),c.Ob(18,"option",7),c.Ob(19,"span",6),c.qc(20,"\u0418\u043c\u043f\u043e\u0440\u0442"),c.Mb(),c.Mb(),c.Ob(21,"option",8),c.Ob(22,"span",6),c.qc(23,"\u042d\u043a\u0441\u043f\u043e\u0440\u0442"),c.Mb(),c.Mb(),c.Mb(),c.Ob(24,"label"),c.qc(25,"\u0417\u0430\u044f\u0432\u043a\u0438"),c.Mb(),c.Mb(),c.Mb(),c.Mb(),c.Mb(),c.Ob(26,"tbody"),c.oc(27,y,15,15,"tr",9),c.Zb(28,"searchO"),c.Mb(),c.Mb(),c.Ob(29,"div",10,11),c.oc(31,v,30,10,"div",12),c.Ob(32,"div",13),c.Ob(33,"button",14),c.qc(34,"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440"),c.Mb(),c.Ob(35,"button",15),c.Wb("click",(function(t){return e.addDelivery()})),c.qc(36,"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c"),c.Mb(),c.Ob(37,"button",16),c.Wb("click",(function(t){return e.closeModal()})),c.Ob(38,"i",17),c.qc(39,"close"),c.Mb(),c.Mb(),c.Mb(),c.Mb()),2&t&&(c.yb(2),c.cc("ngStyle",c.dc(11,m)),c.yb(10),c.nc("margin",0,"px"),c.yb(1),c.cc("ngModel",e.searchOrd),c.yb(5),c.cc("value",e.shop),c.yb(9),c.cc("ngForOf",c.bc(28,8,e.gsorders,c.fc(12,w,e.searchOrd,e.shop))),c.yb(4),c.cc("ngIf",e.selectedOrder),c.yb(2),c.cc("disabled",!e.workOrder),c.yb(2),c.cc("disabled",e.workOrder))},directives:[r.m,d.o,d.i,d.k,d.l,d.q,r.k,r.l],pipes:[u.a,r.e],styles:[".bold[_ngcontent-%COMP%]{font-weight:700;color:#6e4a4a}"]}),t})();var k=i("668k");const F=["tooltip"];function I(t,e){if(1&t){const t=c.Pb();c.Ob(0,"app-history-filter",10),c.Wb("onFilter",(function(e){return c.jc(t),c.Yb().applyFilter(e)})),c.Mb()}}function C(t,e){if(1&t){const t=c.Pb();c.Ob(0,"button",17),c.Wb("click",(function(e){return c.jc(t),c.Yb(4).loadMore()})),c.qc(1," \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0435\u0449\u0435 "),c.Mb()}}function V(t,e){1&t&&c.Lb(0,"app-loader")}function D(t,e){if(1&t&&(c.Ob(0,"div",14),c.oc(1,C,2,0,"button",15),c.oc(2,V,1,0,"ng-template",null,16,c.pc),c.Mb()),2&t){const t=c.hc(3),e=c.Yb(3);c.yb(1),c.cc("ngIf",!e.loading)("ngIfElse",t)}}function S(t,e){if(1&t){const t=c.Pb();c.Ob(0,"div"),c.Ob(1,"app-history-list",12),c.Wb("gsordersChange",(function(e){return c.jc(t),c.Yb(2).orders=e}))("onAddDelivery",(function(e){return c.jc(t),c.Yb(2).updateDeliveryForm(e)})),c.Mb(),c.oc(2,D,4,2,"div",13),c.Mb()}if(2&t){const t=c.Yb(2);c.yb(1),c.cc("gsorders",t.orders),c.yb(1),c.cc("ngIf",!t.noMoreOrders)}}function W(t,e){1&t&&(c.Ob(0,"div",18),c.qc(1,"\u0417\u0430\u043a\u0430\u0437\u043e\u0432 \u043f\u043e\u043a\u0430 \u043d\u0435\u0442."),c.Mb())}function Y(t,e){if(1&t&&(c.Ob(0,"div"),c.oc(1,S,3,2,"div",7),c.oc(2,W,2,0,"ng-template",null,11,c.pc),c.Mb()),2&t){const t=c.hc(3),e=c.Yb();c.yb(1),c.cc("ngIf",e.orders.length>0)("ngIfElse",t)}}function j(t,e){1&t&&c.Lb(0,"app-loader")}const E=function(t,e){return{active:t,red:e}};let x=(()=>{class t{constructor(t){this.ordersService=t,this.isFilterVisible=!1,this.orders=[],this.filter={},this.offset=0,this.limit=6,this.loading=!1,this.reloading=!1,this.noMoreOrders=!1}ngOnInit(){this.reloading=!0,this.fetch()}fetch(){const t=Object.assign({},this.filter,{offset:this.offset,limit:this.limit});this.oSub=this.ordersService.fetch(t).subscribe(t=>{this.orders=this.orders.concat(t),this.noMoreOrders=t.length<6,this.loading=!1,this.reloading=!1})}loadMore(){this.offset+=6,this.loading=!0,this.fetch()}ngOnDestroy(){this.tooltip.destroy(),this.oSub.unsubscribe()}applyFilter(t){this.orders=[],this.offset=0,this.filter=t,this.reloading=!0,this.fetch()}ngAfterViewInit(){this.tooltip=n.a.initTooltip(this.tooltipRef)}isFiltered(){return 0!==Object.keys(this.filter).length}updateHistoryList(){this.orders=[],this.offset=0,this.reloading=!0,this.fetch()}updateDeliveryForm(t){this.deliveryOrder=t}}return t.\u0275fac=function(e){return new(e||t)(c.Kb(o.a))},t.\u0275cmp=c.Eb({type:t,selectors:[["app-history-page"]],viewQuery:function(t,e){var i;1&t&&c.vc(F,!0),2&t&&c.gc(i=c.Xb())&&(e.tooltipRef=i.first)},decls:18,vars:8,consts:[[1,"page-title"],["col","","s6",""],["data-tooltip","\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0437\u0430\u043a\u0430\u0437\u043e\u0432","data-position","left",1,"btn","btn-small","waves-effect","waves-light",3,"click"],["tooltip",""],[1,"material-icons"],[1,"btn","btn-small","waves-effect","waves-light",3,"ngClass","click"],[3,"onFilter",4,"ngIf"],[4,"ngIf","ngIfElse"],["reloadingBlock",""],[3,"deliveryOrder"],[3,"onFilter"],["empty",""],[3,"gsorders","gsordersChange","onAddDelivery"],["class","center mb2",4,"ngIf"],[1,"center","mb2"],["class","btn waves-effect grey darken-1 btn-small",3,"click",4,"ngIf","ngIfElse"],["loader",""],[1,"btn","waves-effect","grey","darken-1","btn-small",3,"click"],[1,"center"]],template:function(t,e){if(1&t&&(c.Ob(0,"div",0),c.Ob(1,"h5"),c.qc(2,"\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0437\u0430\u043a\u0430\u0437\u043e\u0432"),c.Mb(),c.Ob(3,"div",1),c.Ob(4,"button",2,3),c.Wb("click",(function(t){return e.updateHistoryList()})),c.Ob(6,"i",4),c.qc(7,"update"),c.Mb(),c.Mb(),c.Ob(8,"span"),c.qc(9,"\xa0"),c.Mb(),c.Ob(10,"button",5),c.Wb("click",(function(t){return e.isFilterVisible=!e.isFilterVisible})),c.Ob(11,"i",4),c.qc(12,"filter_list"),c.Mb(),c.Mb(),c.Mb(),c.Mb(),c.oc(13,I,1,0,"app-history-filter",6),c.oc(14,Y,4,2,"div",7),c.oc(15,j,1,0,"ng-template",null,8,c.pc),c.Lb(17,"app-modal-delivery",9)),2&t){const t=c.hc(16);c.yb(10),c.cc("ngClass",c.fc(5,E,e.isFilterVisible,e.isFiltered())),c.yb(3),c.cc("ngIf",e.isFilterVisible),c.yb(1),c.cc("ngIf",!e.reloading)("ngIfElse",t),c.yb(3),c.cc("deliveryOrder",e.deliveryOrder)}},directives:[r.j,r.l,b.a,h,q,k.a],styles:[""]}),t})();var L=i("V/fk"),P=i("tyNb");const R=[{path:"",component:x}];let H=(()=>{class t{}return t.\u0275mod=c.Ib({type:t}),t.\u0275inj=c.Hb({factory:function(e){return new(e||t)},imports:[[P.h.forChild(R)],P.h]}),t})();i.d(e,"HistoryModule",(function(){return _}));let _=(()=>{class t{}return t.\u0275mod=c.Ib({type:t}),t.\u0275inj=c.Hb({factory:function(e){return new(e||t)},providers:[],imports:[[r.c,s.a,H,L.a]]}),t})()}}]);